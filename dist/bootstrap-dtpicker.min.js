/* Bootstrap based datepicker control - Version 1.0.0 - Date: 06.12.2014 - (c) 2014 CodeFirst */
!function(a){"function"==typeof define&&define.amd?define(["jquery","moment"],a):a(jQuery,moment)}(function(a,b){"use strict";if("function"!=typeof a)throw"Bootstrap Datepicker plugin: jQuery not found. Please ensure jQuery is referenced before the bootstrap-dtpicker.js file.";if("function"!=typeof b)throw"Bootstrap Datepicker plugin: momentjs not found. Please ensure momentjs is referenced before the bootstrap-dtpicker.js file.";a.fn.dtpicker=function(c){function d(){var a=this;a.notifyDateChanged=function(a,c){var d=c?b(c):null,e=null;d&&d.isValid()&&(e=d.startOf("day").toDate()),a.trigger("dateChanged",[e])},a.format=function(a){if(a){var c=b(a);return c.isValid()?c.format(i.format):i.emptyText}return i.emptyText}}function e(c,d){function e(){f(),g()}function f(){var b=a('<div class="input-group"/>');m.hasClass("dtpicker-lg")?b.addClass("input-group-lg"):m.hasClass("dtpicker-sm")&&b.addClass("input-group-sm"),b.append(a('<input type="text" class="form-control" readonly="readonly" />').attr("placeholder",p.placeholder)),b.append(a('<span class="input-group-btn"></span>').append(a('<button type="button" class="btn btn-default datebutton"></button>').addClass(p.buttonClass))),m.addClass("dtpicker").append(b),j=m.find(".input-group > input[type = 'text']"),k=m.find(".input-group > .input-group-btn > .datebutton")}function g(){j.on("focusin",a.proxy(h,l)),k.on("click",a.proxy(i,l))}function h(){r.show(!0)}function i(){r.toggle()}var j,k,l=this,m=c,n=b().toDate(),o=null,p=d,q=10,r=function(){function c(b,c,d){switch(b){case"auto":var e=d.outerHeight(),f=a(window).height(),g=c.offset().top,h=c.outerHeight();return f>g+h+1+e+q?"bottom":g>h+1+e+q?"top":"bottom";case"left":case"right":case"top":case"bottom":return b;default:throw'"'+b+'" placement mode is incorrect.'}}function d(b,c,d,e){var f=e.outerWidth(),g=e.outerHeight(),h=a(window).width(),i=a(window).height(),j=c.offset().top,k=c.offset().left,l=c.outerHeight(),m=c.outerWidth(),n=d.outerWidth(),o=a(window).scrollTop(),p=i+o,r={left:0,top:0};switch(b){case"bottom":r.top=j+l+1,k+f+q>h?(r.left=h-(f+q),r.left<q&&(r.left=q)):r.left=k;break;case"top":r.top=j-g-1,k+f+q>h?(r.left=h-(f+q),r.left<q&&(r.left=q)):r.left=k;break;case"left":r.top=j-g/2+l/2,r.top+g>p&&(r.top=p-g-1),r.top<q&&(r.top=q),r.left=k-f-1,r.left<q&&(r.left=q);break;case"right":r.top=j-g/2+l/2,r.top+g>p&&(r.top=p-g-1),r.top<q&&(r.top=q),r.left=k+m+n+1,r.left+f+q>h&&(r.left=h-f-q);break;default:throw'"'+b+'" placement mode is incorrect.'}return r}function e(b){var c=0==a(b.target).closest(h).length,d=0==a(b.target).closest(m).length;c&&d&&g.hide()}function f(a){switch(a.keyCode){case 9:g.hide();break;case 27:p.closeOnEsc&&(g.hide(),j.blur())}}var g={},h=null,i={_daysCalendarBody:null,_daysCalendarTitle:null,invalidate:function(){this.invalidateTextbox(),this.invalidateTitle(),this.invalidateContent()},invalidateTitle:function(){this._daysCalendarTitle&&this._daysCalendarTitle.html(n?b(n).format(p.daysTitleFormat):"")},invalidateContent:function(){this._daysCalendarBody&&this._daysCalendarBody.empty().append(this.buildDaysTableContent(n,p.startDay,p.displayToday,p.closeOnSelect))},invalidateTextbox:function(){p.updateText&&j.val(l.format(o))},changeDate:function(a,c){a!=o&&(n=a?a:b().startOf("day").toDate(),o=a,this.invalidate(),c||l.notifyDateChanged(m,o))},buildPopover:function(){var b=a('<div class="popover in hide dtpicker-popover" style="display: none;"><div class="arrow"></div></div>');return b.append(this.buildPopoverTitle()),b.append(this.buildPopoverContent()),b},buildPopoverTitle:function(){var c=a('<div class="popover-title"></div>'),d=a('<div class="toolbar"></div>'),e=a('<button class="btn-prev btn-left">&#8666;</button>'),f=a('<button class="btn-prev">&laquo;</button>'),g=this._daysCalendarTitle=a('<button class="btn-mode">'+b(n).format(p.daysTitleFormat)+"</button>"),h=a('<button class="btn-next">&raquo;</button>'),i=a('<button class="btn-prev btn-right">&#8667;</button>');return d.append(a('<div class="col-xs-2"></div>').append(e)),d.append(a('<div class="col-xs-2"></div>').append(f)),d.append(a('<div class="col-xs-4"></div>').append(g)),d.append(a('<div class="col-xs-2"></div>').append(h)),d.append(a('<div class="col-xs-2"></div>').append(i)),c.append(d),e.on("click",a.proxy(function(){n=b(n).add("y",-1).toDate(),this.invalidate()},this)),f.on("click",a.proxy(function(){n=b(n).add("M",-1).toDate(),this.invalidate()},this)),h.on("click",a.proxy(function(){n=b(n).add("M",1).toDate(),this.invalidate()},this)),i.on("click",a.proxy(function(){n=b(n).add("y",1).toDate(),this.invalidate()},this)),c},buildPopoverContent:function(){var b=a('<div class="popover-content"></div>');return b.append(this.buildDaysTable()),b},buildDaysTable:function(){function c(b){return a("<thead></thead>").append(a("<tr></tr>").append(d(b)))}function d(c){if(c>6)throw"Start day can't be more than 6.";for(var d=[],e=b().day(c),f=0;7>f;f++){var g=a("<th></th>").text(e.format("ddd"));d.push(g),e.add("day",1)}return d}function e(c,d,e){var f=null,h=null;c&&(f=a('<button class="btn-today">Today</button>'),f.on("click",a.proxy(function(){e&&g.hide(),this.changeDate(b().startOf("day").toDate())},this))),d&&(h=a('<button class="btn-clear">Clear</button>'),h.on("click",a.proxy(function(){e&&g.hide(),this.changeDate(null)},this)));var i=a('<td colspan="7"></td>');return f&&h?(i.append(a('<div class="col-xs-6"></div>').append(f)),i.append(a('<div class="col-xs-6"></div>').append(h))):f?i.append(f):h&&i.append(h),f||h?a("<tfoot></tfoot>").append(a("<tr></tr>").append(i)):null}var f=a('<table class="days"></table>');f.append(c(p.startDay)),f.append(this._daysCalendarBody=a("<tbody></tbody>").append(this.buildDaysTableContent(n,p.startDay,p.displayToday,p.closeOnSelect)));var h=e.call(this,p.todayButtonVisible,p.clearButtonVisible,p.closeOnSelect);return h&&f.append(h),f},buildDaysTableContent:function(c,d,e,f){if(d>6)throw"Start day can't be more than 6.";for(var h=b(c).startOf("month");h.day()!=d;)h.add("d",-1);for(var i=b(),j=b(o),k=b(c),l=k.month(),m=Math.ceil((b(c).endOf("month").diff(h,"days")+1)/7),n=[],p=0;m>p;p++){for(var q=[],r=0;7>r;r++){var s=l!=h.month()&&k.isAfter(h),t=l!=h.month()&&k.isBefore(h),u=a('<button class="btn-date"></button>').text(h.format("D")).attr("data-dtvalue",h.toISOString());s&&u.addClass("prev"),t&&u.addClass("next"),e&&i.isSame(h,"day")&&u.addClass("today"),j&&j.isSame(h,"day")&&u.addClass("selected"),u.on("click",{layout:this},function(c){f&&g.hide();var d=b(a(this).attr("data-dtvalue"));c.data.layout.changeDate(d.isValid()?d.toDate():null),c.data.layout.invalidate()}),q.push(a("<td></td>").append(u)),h.add("d",1)}n.push(a("<tr></tr>").append(q))}return n}};return g.invalidate=function(){i.invalidate()},g.changeDate=function(a,b){i.changeDate(a,b)},g.build=function(){h=i.buildPopover(),a("body").append(h)},g.place=function(){if(h){var a=j,b=(a.offset(),c(p.placement,a,h)),e=d(b,a,k,h);h.removeClass("top bottom right left"),p.displayArrow&&h.addClass(b),h.css({top:e.top,left:e.left})}},g.toggle=function(){h&&h.is(":visible")?g.hide():g.show()},g.show=function(b){h||g.build(),h.removeClass("hide").show(),g.place(),a(document).on("mousedown",a.proxy(e,g)),a(window).on("resize",a.proxy(g.place,g)),j.on("keydown",a.proxy(f,g)),b||j.focus()},g.hide=function(){h&&(a(document).off("mousedown",a.proxy(e,g)),a(window).off("resize",a.proxy(g.place,g)),j.off("keydown",a.proxy(f,g)),h.remove(),h=null)},g}();return l.getDate=function(){return o},l.setDate=function(a,b){return r.changeDate(a,b),o},e(),l}function f(c,d){function e(){f(),g(),m.trigger("change")}function f(){var b=a('<div class="input-group"/>');o.hasClass("dtpicker-lg")?b.addClass("input-group-lg"):o.hasClass("dtpicker-sm")&&b.addClass("input-group-sm"),b.append(a('<input type="text" class="form-control" readonly="readonly" />').attr("placeholder",p.placeholder)),b.append(a('<span class="input-group-btn"></span>').append(a('<input type="date" class="btn btn-default datebutton" value="" />').addClass(p.buttonClass))),o.addClass("dtpicker").append(b),l=o.find(".input-group > input[type = 'text']"),m=o.find(".input-group > .input-group-btn > .datebutton")}function g(){m.on("change blur keyup click",j),l.on("click",a.proxy(k,n))}function h(){p.updateText&&l.val(n.format(q))}function i(){var a=b(q);m.val(a&&a.isValid()?a.format("YYYY-MM-DD"):"")}function j(){if(this.valueAsDate){var a=b.utc(this.valueAsDate);q=b([a.year(),a.month(),a.date(),0,0,0,0]).toDate()}else q=null;h(),n.notifyDateChanged(o,q)}function k(){m.blur(),m.click(),m.focus()}var l,m,n=this,o=c,p=d,q=null;return n.getDate=function(){return q},n.setDate=function(a){return q=a,h(),i(),q},e(),n}var g="jquery-datepicker",h={};"object"==typeof c&&(h=c);var i=a.extend({},a.fn.dtpicker.defaults,h);e.prototype=new d,f.prototype=new d;var j={_browsers:[function(){return!!window.chrome&&/Chrome\//.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)},function(){return/Safari\//.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)}],validateBrowser:function(){for(var a=!1,b=0;b<this._browsers.length&&!(a|=this._browsers[b]());b++);return a},validateTouch:function(){var a=!1;return("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(a=!0),a},validateInputType:function(a){var b=document.createElement("input");return b.setAttribute("type",a),b.type==a}},k=arguments,l=[],m=void 0;return this.each(function(){var b=void 0,d=a(this).data(g),h=c;if(void 0==d)d=j.validateBrowser()&&j.validateTouch()&&j.validateInputType("date")?new f(a(this),i):new e(a(this),i),a(this).data(g,d),b=this;else if(void 0!=d[h]&&"function"==typeof d[h]){var n=d[h].apply(d,Array.prototype.slice.call(k,1));b=this,0==l.length&&(m=n)}else void 0!=h&&(b=a.error("There is no method with "+h+" name."));l.push(b)}),void 0!==m?m:a(l)},a.fn.dtpicker.defaults={buttonClass:"btn-default",placeholder:"",emptyText:"",format:"DD/MM/YYYY",updateText:!0,closeOnEsc:!0,placement:"auto",displayArrow:!0,startDay:1,todayButtonVisible:!0,clearButtonVisible:!0,daysTitleFormat:"MMMM<br/> YYYY",displayToday:!0,closeOnSelect:!0},Function.prototype.memoized=function(a){return this._values=this._values||{},void 0!==this._values[a]?this._values[a]:this._values[a]=this.apply(this,arguments)},Function.prototype.memoize=function(){var a=this;return function(){return a.memoized.apply(a,arguments)}},a(function(){a("*[data-dtpicker]").each(function(){var b=a(this),c={};b.dtpicker(c)})})});